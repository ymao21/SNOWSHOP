{"ast":null,"code":"import { csrfFetch } from \"./csrf\";\nconst LOAD_PRODUCTS = 'products/loadProducts';\nconst CREATE_PRODUCT = 'products/createProduct';\nconst EDIT_PRODUCT = 'products/editProduct';\nconst DELETE_PRODUCT = 'products/deleteProduct';\nexport const loadProducts = products => {\n  return {\n    type: LOAD_PRODUCTS,\n    products\n  };\n};\nexport const addOneProduct = product => {\n  return {\n    type: CREATE_PRODUCT,\n    product\n  };\n};\nexport const editProduct = product => {\n  return {\n    type: EDIT_PRODUCT,\n    product\n  };\n};\nexport const deleteProduct = productId => {\n  return {\n    type: DELETE_PRODUCT,\n    productId\n  };\n};\nexport const getProductsThunk = () => async dispatch => {\n  const response = await csrfFetch('/api/products');\n  if (response.ok) {\n    const products = await response.json();\n    return dispatch(loadProducts(products.products));\n  }\n  return response;\n};\nexport const getProductDetailThunk = productId => async dispatch => {\n  const response = await csrfFetch(`/api/products/${productId}`);\n  if (response.ok) {\n    const product = await response.json();\n    return dispatch(addOneProduct(product));\n  }\n  return response;\n};\nexport const createProductThunk = payload => async dispatch => {\n  const formData = new FormData();\n  formData.append(\"name\", payload.name);\n  formData.append(\"color\", payload.color);\n  formData.append(\"price\", payload.price);\n  formData.append(\"category\", payload.category);\n  formData.append(\"type\", payload.type);\n  formData.append(\"description\", payload.description);\n  if (payload.image) {\n    formData.append(\"image\", payload.image);\n  } else {\n    const defaultImageUrl = \"https://digitalfinger.id/wp-content/uploads/2019/12/no-image-available-icon-6-600x375.png.webp\";\n    const response = await fetch(defaultImageUrl);\n    if (response.ok) {\n      const blob = await response.blob();\n      const file = new File([blob], \"NoImage.png\", {\n        type: blob.type\n      });\n      formData.append(\"image\", file);\n    } else {\n      throw new Error(\"Failed to fetch the default image.\");\n    }\n  }\n  const response = await csrfFetch(`/api/products/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"multipart/form-data\"\n    },\n    body: formData\n  });\n  if (response.ok) {\n    const newProduct = await response.json();\n    dispatch(addOneProduct(newProduct));\n    return newProduct;\n  }\n  return response;\n};\nexport const editProductThunk = payload => async dispatch => {\n  const formData = new FormData();\n  formData.append(\"name\", payload.name);\n  formData.append(\"color\", payload.color);\n  formData.append(\"price\", payload.price);\n  formData.append(\"category\", payload.category);\n  formData.append(\"type\", payload.type);\n  formData.append(\"description\", payload.description);\n  if (payload.image) {\n    formData.append(\"image\", payload.image);\n  } else {\n    formData.append(\"image\", \"https://getitdone.sandiego.gov/resource/1463537407000/NoImage\");\n  }\n  const response = await csrfFetch(`/api/products/${payload.productId}`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"multipart/form-data\"\n    },\n    body: formData\n  });\n  if (response.ok) {\n    const productEdit = await response.json();\n    console.log(\"productEdit\", productEdit);\n    dispatch(editProduct(productEdit));\n    return productEdit;\n  }\n  return response;\n};\nexport const deleteProductThunk = productId => async dispatch => {\n  const response = await csrfFetch(`/api/products/${productId}`, {\n    method: 'DELETE'\n  });\n  if (response.ok) {\n    const deletedProduct = await response.json();\n    dispatch(deleteProduct(productId));\n    return deletedProduct;\n  }\n  return response;\n};\nconst initialState = {};\nconst productsReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  let newState = {\n    ...state\n  };\n  switch (action.type) {\n    case LOAD_PRODUCTS:\n      action.products.forEach(product => {\n        newState[product.id] = product;\n      });\n      return newState;\n    case CREATE_PRODUCT:\n      newState = {\n        ...state\n      };\n      newState[action.product.id] = action.product;\n      return newState;\n    case EDIT_PRODUCT:\n      const updateProduct = {\n        ...state\n      };\n      updateProduct[action.product.id] = action.product;\n      return updateProduct;\n    case DELETE_PRODUCT:\n      newState = {\n        ...state\n      };\n      delete newState[action.productId];\n      return newState;\n    default:\n      return state;\n  }\n};\nexport default productsReducer;","map":{"version":3,"names":["csrfFetch","LOAD_PRODUCTS","CREATE_PRODUCT","EDIT_PRODUCT","DELETE_PRODUCT","loadProducts","products","type","addOneProduct","product","editProduct","deleteProduct","productId","getProductsThunk","dispatch","response","ok","json","getProductDetailThunk","createProductThunk","payload","formData","FormData","append","name","color","price","category","description","image","defaultImageUrl","fetch","blob","file","File","Error","method","headers","body","newProduct","editProductThunk","productEdit","console","log","deleteProductThunk","deletedProduct","initialState","productsReducer","state","arguments","length","undefined","action","newState","forEach","id","updateProduct"],"sources":["/Users/yiningmao/Desktop/SNOWSHOP Project/SNOWSHOP/frontend/src/store/products.js"],"sourcesContent":["import { csrfFetch } from \"./csrf\";\n\nconst LOAD_PRODUCTS = 'products/loadProducts'\nconst CREATE_PRODUCT = 'products/createProduct'\nconst EDIT_PRODUCT ='products/editProduct'\nconst DELETE_PRODUCT = 'products/deleteProduct'\n\nexport const loadProducts = (products) => {\n    return {\n        type: LOAD_PRODUCTS,\n        products\n    }\n}\n\nexport const addOneProduct = (product) => {\n    return {\n        type: CREATE_PRODUCT,\n        product\n    }\n}\n\nexport const editProduct = (product) => {\n    return {\n        type: EDIT_PRODUCT,\n        product\n    }\n}\n\nexport const deleteProduct = (productId) => {\n    return {\n        type: DELETE_PRODUCT,\n        productId\n    }\n}\n\nexport const getProductsThunk = () => async (dispatch) => {\n    const response = await csrfFetch('/api/products');\n\n    if(response.ok) {\n        const products = await response.json();\n\n        return dispatch(loadProducts(products.products))\n\n    }\n    return response\n}\n\nexport const getProductDetailThunk = (productId) => async (dispatch) => {\n    const response = await csrfFetch(`/api/products/${productId}`);\n\n    if(response.ok) {\n        const product = await response.json();\n        return dispatch(addOneProduct(product))\n    }\n    return response\n}\n\nexport const createProductThunk = (payload) => async (dispatch) => {\n    const formData = new FormData();\n\n    formData.append(\"name\", payload.name)\n    formData.append(\"color\",  payload.color)\n    formData.append(\"price\",payload.price)\n    formData.append(\"category\",payload.category)\n    formData.append(\"type\",  payload.type)\n    formData.append(\"description\", payload.description)\n    if (payload.image) {\n        formData.append(\"image\", payload.image);\n      } else {\n        const defaultImageUrl =\n        \"https://digitalfinger.id/wp-content/uploads/2019/12/no-image-available-icon-6-600x375.png.webp\";\n      const response = await fetch(defaultImageUrl);\n      if (response.ok) {\n        const blob = await response.blob();\n        const file = new File([blob], \"NoImage.png\", { type: blob.type });\n        formData.append(\"image\", file);\n      } else {\n        throw new Error(\"Failed to fetch the default image.\");\n      }\n      }\n\n    const response = await csrfFetch(`/api/products/`,{\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n        body: formData,\n      });\n\n    if(response.ok) {\n        const newProduct = await response.json();\n        dispatch(addOneProduct(newProduct));\n        return newProduct\n    }\n    return response\n}\n\n\nexport const editProductThunk = (payload) => async (dispatch) => {\n  const formData = new FormData();\n  formData.append(\"name\", payload.name);\n  formData.append(\"color\", payload.color);\n  formData.append(\"price\", payload.price);\n  formData.append(\"category\", payload.category);\n  formData.append(\"type\", payload.type);\n  formData.append(\"description\", payload.description);\n\n  if (payload.image) {\n    formData.append(\"image\", payload.image);\n  }else {\n    formData.append(\n      \"image\",\n      \"https://getitdone.sandiego.gov/resource/1463537407000/NoImage\"\n    );\n  }\n    const response = await csrfFetch(`/api/products/${payload.productId}`, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n      },\n      body: formData,\n    });\n\n    if (response.ok) {\n      const productEdit = await response.json();\n      console.log(\"productEdit\", productEdit);\n      dispatch(editProduct(productEdit));\n      return productEdit;\n    }\n    return response;\n  };\n\n\nexport const deleteProductThunk = (productId) => async (dispatch) => {\n    const response = await csrfFetch(`/api/products/${productId}`, {\n        method: 'DELETE'\n    })\n\n    if(response.ok) {\n        const deletedProduct = await response.json()\n        dispatch(deleteProduct(productId))\n        return deletedProduct\n    }\n    return response\n}\n\nconst initialState = {};\n\nconst productsReducer = (state = initialState, action) => {\n\n    let newState = {...state};\n    switch(action.type){\n        case LOAD_PRODUCTS:\n\n            action.products.forEach((product) => {\n                newState[product.id] = product\n            });\n            return newState\n\n        case CREATE_PRODUCT:\n            newState = {...state}\n            newState[action.product.id] = action.product\n            return newState\n\n        case EDIT_PRODUCT:\n\n            const updateProduct = {...state}\n            updateProduct[action.product.id] = action.product;\n            return updateProduct;\n\n        case DELETE_PRODUCT:\n            newState = {...state}\n            delete newState[action.productId]\n            return newState\n\n        default:\n            return state;\n    }\n}\n\nexport default productsReducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}